# 组合|聚合复用原则

<!--
create time: 2018-07-30 12:02:56
Author: <黄东鸿>
-->

### 什么是组合/聚合复用原则

> 定义：组合/聚合复用原则又叫做合成复用原则， 就是在一个新的对象里面使用一些已有的对象，使之成为新对象的一部分：新的对象通过向这些对象的委派达到复用已有功能的目的。

**这个原则的简短表述就是：多用组合/聚合，少用继承。**

组合（Composition，也有翻译成合成）和聚合（Aggregation），都是关联的特殊种类。聚合表示一种弱的“拥有”关系，体现的是A对象可以包含B对象，但B对象不是A对象的一部分；组合(合成)是一种强的“拥有”关系，体现了严格的部分与整体的关系，部分和整体的生命周期是一样的。

组合/聚合UML示意图如图1所示：

![组合/聚合UML结构示意图](http://os3yasu4i.bkt.clouddn.com/composition-aggregation.png)

### 组合/聚合复用和继承复用的优缺点

在面向对象的设计里，有两种基本的方法可以在不同的环境中复用已有的设计和实现，即通过组合/聚合或通过继承。

#### 组合/聚合

由于组合/聚合可以将已有的对象纳入到新对象中，使之成为新对象的一部分，因此新对象可以调用已有对象的功能，这样做有下面的好处：

* 新对象存取成分对象的唯一方法是通过成分对象的接口。
* 这种复用是黑箱复用，因为成分对象的内部细节是新对象所看不见的。
* 这种复用支持包装。
* 这种复用所需要的依赖较少。
* 每一个新的类可以将焦点集中到一个任务上。
* 这种复用可以在运行时间动态进行，新对象可以动态的引用与成分对象类型相同的对象。

组合/聚合复用的缺点就是用组合/聚合复用建造的系统会有较多的对象需要管理。

#### 继承

继承复用通过扩展一个已有对象的实现来得到新的功能，基类明显的捕获共同的属性和方法，而子类通过增加新的属性和方法来扩展超类的实现。

继承的优点：
* 新的实现比较容易，因为基类的大部分功能都可以通过继承自动的进入子类。
* 修改或扩展继承而来的实现较为容易。

继承的缺点：

* 继承复用破坏了包装，因为继承超类的的实现细节暴露给子类。由于超类的内部细节常常对子类是透明的，因此这种复用是透明的复用，又称“白箱”复用。
* 如果超类的实现发生改变，那么子类的实现也不得不发生改变。因此，当一个基类发生改变时，这种改变就会像水中投入石子引起的水波一样，将变化一圈又一圈的传导到一级又一级的子类，使设计师不得不相应地改变这些子类，以适应超类的变化。
* 从超类继承而来的实现是静态的，不可能在运行时间内发生改变，因此没有足够的灵活性。

### 使用组合还是继承

按照组合/聚合复用原则我们应该首选组合/聚合，然后才是继承，**使用继承时应该严格的遵守里氏替换原则，必须满足“Is-A”的关系是才能使用继承，而组合却是一种“Has-A”的关系**。导致错误的使用继承而不是使用组合的一个重要原因可能就是错误的把“Has-A”当成了“Is-A”。

下面看一个例子：

![](http://os3yasu4i.bkt.clouddn.com/composition-aggregation-is-a.jpg)

人被继承到雇员，学生，经理子类。而实际上，雇员、学生和经理分别描述一种角色，而人可以同时有几种不同的角色。比如，一个人既然是经理了就一定是雇员，使用继承来实现角色，则只能使用每一个人具有一种角色，这显然是不合理的。错误的原因就是把角色的等级结构和人的等级结构混淆起来，把Has-A的关系误认为是Is-A的关系，通过下面的改正就可以正确的做到这一点。

![](http://os3yasu4i.bkt.clouddn.com/composition-aggregation-has-a.jpg)

从上图可以看出，每一个人都可以有一个以上的角色，所以一个人可以同时是雇员又是经理。从这个例子可以看出，当一个类是另一个类的角色时，不应该使用继承描述这种关系。

### 参考

[设计原则（三）组合复用原则](https://www.kancloud.cn/digest/xing-designpattern/143720)
